// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  coffeeEntries     CoffeeEntry[]
  customCoffeeTypes CustomCoffeeType[]
  companions        Companion[]

  @@map("users")
}

model CustomCoffeeType {
  id        String   @id @default(uuid())
  userId    String
  name      String
  caffeine  Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  entries CoffeeEntry[]

  @@unique([userId, name])
  @@index([userId])
  @@map("custom_coffee_types")
}

model Companion {
  id        String   @id @default(uuid())
  userId    String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  entries CoffeeEntry[] @relation("EntryCompanions")

  @@unique([userId, name])
  @@index([userId])
  @@map("companions")
}

model CoffeeEntry {
  id           String      @id @default(uuid())
  userId       String
  type         CoffeeType?
  customTypeId String?
  size         CoffeeSize
  caffeine     Int         @default(0)
  notes        String?     @db.Text
  consumedAt   DateTime    @default(now())
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  user       User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  customType CustomCoffeeType? @relation(fields: [customTypeId], references: [id], onDelete: SetNull)
  companions Companion[]       @relation("EntryCompanions")

  @@index([userId, consumedAt])
  @@index([userId])
  @@map("coffee_entries")
}

enum CoffeeType {
  ESPRESSO
  AMERICANO
  LATTE
  CAPPUCCINO
  FLAT_WHITE
  MACCHIATO
  MOCHA
  COLD_BREW
  ICED_COFFEE
  DRIP_COFFEE
  POUR_OVER
  FRENCH_PRESS
  OTHER
}

enum CoffeeSize {
  SMALL
  MEDIUM
  LARGE
  EXTRA_LARGE
}
